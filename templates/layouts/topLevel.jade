
extends ../layouts/default.jade

include ../mixins/blast-button.jade
include ../mixins/mutable-fields.jade
include ../mixins/attachments.jade
include ../mixins/citations.jade

block jsState
    script meta =
        != JSON.stringify(meta)

    script.
        function popup() {
            popupS.modal({
                content: '<div class="form-group"><label for="share">Copy the following link to share</label><input id="share" type="text" class="form-control" style="width:30em;" readonly value="#{share}"/></div>',
            });
        }

block breadcrumbs
    ul
        li.inactive
            a(href='/search')
                span.fa.fa-search
                |  Search
        li
            a(href=meta.url) #{meta.uri}


block topTitle
    | #{meta.name?meta.name.replace(/[ ]*Collection/, ''):meta.id}
    if meta.name
        if meta.id && meta.id != meta.name && meta.id.indexOf('_collection') === -1
            span (#{meta.id})
        if (meta.id.indexOf('_collection') !== -1)
            span Library
    if meta.sbhBookmark && meta.sbhBookmark.description == 'true'
        a(href='http://wiki.synbiohub.org/Terms/synbiohub#bookmark',title='Bookmarked Parts')
            span.fa.fa-bookmark
    if meta.sbhStar && meta.sbhStar.description == 'true'
        a(href='http://wiki.synbiohub.org/Terms/synbiohub#star',title='Starred Parts')
            span.fa.fa-star

block content

    div.sbh-container.container-fluid

        if meta.description && meta.description != ''
            div.row
                div.col-sm-12.text-center.sbh-desc-container
                    block beforeTopTitle
                    div.sbh-top-description-container
                        div.sbh-top-description
                            != meta.description
            div.row
                div.col-sm-12.sbh-id-etc.text-center
                    if locals.remote
                        span #{'Mirrored from '}
                            a(href=locals.remote.url,title='Edit in ' + locals.remote.name) #{locals.remote.name}

                        span  Version #{meta.version}
                            //
                            //
                            // Nobody cares.
                            //
                            //
                            // if rdfType
                            //!= ' (' + rdfType.name + ') '
                            //a(href=rdfType.url,title='Learn more about this RDF type')
                            //span.fa.fa-info-circle

                    if meta.igemDiscontinued && meta.igemDiscontinued.description == 'true'
                        span(style=" color: #FF0000") This part has been discontinued.
                    if meta.isReplacedBy && meta.isReplacedBy.uri != ''
                        span(style=" color: #FF0000") Please consider using
                            a(href=meta.isReplacedBy.uri) #{meta.isReplacedBy.id}
                            | as a replacement.
        div.row
            div.col-md-12.text-center.sbh-toplevel-preview
                block topLevelPreview


        div.row.entry-heading


        .row
            .col-md-12
                p
                    if meta.creator.description && meta.creator.description != ''
                        | Created by
                        a(href='/search/dc:creator=\''+meta.creator.description+'\'&',title='Find all records created by this author')
                            != meta.creator.description
                        if meta.created.description && meta.created.description != ''
                            |  on
                            a(href='/search/createdBefore='+meta.created.description.split(' ')[0]+'&createdAfter='+meta.created.description.split(' ')[0]+'&',title='Find all records created on this date')
                                != meta.created.description

                    if meta.modified.description && meta.modified.description != ''
                        br
                        | Last modified on
                        a(href='/search/modifiedBefore='+meta.modified.description.split(' ')[0]+'&modifiedAfter='+meta.modified.description.split(' ')[0]+'&',title='Find all records modified on this date')
                            != meta.modified.description

                +mutable-description(meta.mutableDescriptionSource, meta.mutableDescription, canEdit)
                if meta.wasDerivedFrom && meta.wasDerivedFrom != ''
                    p Source:
                        a(href=meta.wasDerivedFrom.toString().startsWith(config.databasePrefix)?'/'+meta.wasDerivedFrom.toString().replace(config.databasePrefix,''):meta.wasDerivedFrom.toString()) #{meta.wasDerivedFrom}
                +mutable-source(meta.sourceSource, meta.source, canEdit)
        .row
            .col-md-6
                a(data-toggle='collapse', data-target='#sbh-property-table')
                    .sbh-section-header
                        h2 Properties
                #sbh-property-table
                    table.table.table-striped.sbh-table
                        tbody
                            if meta.labels && meta.labels.length > 0
                                tr
                                    td Labels
                                    td #{meta.labels.join(', ')}
                            if meta.types && meta.types.length > 0
                                tr
                                    td Types
                                    td
                                        for type in meta.types
                                            if type.description
                                               != type.description.name
                                               a(href=type.term,title='Learn more about this type')
                                                   span.fa.fa-info-circle
                                               a(href='/search/type=<'+encodeURIComponent(type.uri)+'>&',title='Find all records with this type')
                                                   span.fa.fa-search
                                            else
                                               != type.uri
                                               a(href=type.uri,title='Learn more about this type')
                                                   span.fa.fa-info-circle
                                               a(href='/search/type=<'+encodeURIComponent(type.uri)+'>&',title='Find all records with this type')
                                                   span.fa.fa-search
                                            br
                            if meta.roles && meta.roles.length > 0
                                tr
                                    td Roles
                                    td
                                        for role in meta.roles
                                            if role.description
                                                != role.description.name
                                                a(href=role.term,title='Learn more about this role')
                                                    span.fa.fa-info-circle
                                                a(href='/search/role=<'+encodeURIComponent(role.uri)+'>&',title='Find all records with this role')
                                                    span.fa.fa-search
                                            else
                                                != role.term
                                                a(href=role.uri,title='Learn more about this role')
                                                    span.fa.fa-info-circle
                                                a(href='/search/role=<'+encodeURIComponent(role.uri)+'>&',title='Find all records with this role')
                                                    span.fa.fa-search
                                            br
                            for annotation in annotations
                                tr
                                    td #{annotation.name}
                                        a(href=annotation.nameDef,title='Learn more about this annotation type')
                                           span.fa.fa-info-circle
                                    if (annotation.type === 'uri')
                                        td #{annotation.value}
                                            a(href=annotation.url,title='Learn more about this annotation value')
                                                span.fa.fa-info-circle &nbsp;
                                            a(href = '/search/<' + encodeURIComponent(annotation.nameDef) + '>=<' + encodeURIComponent(annotation.uri) + '>&', title = 'Find all records with this annotation')
                                                span.fa.fa-search
                                            if(annotation.removeOwner)
                                                form.form-inline(style="display: inline" method='POST', action=annotation.removeOwner)
                                                    input(type='hidden' name='userUri' value=config.databasePrefix + annotation.value)
                                                    button.fakelink(type='submit')
                                                        | &nbsp;
                                                        span.fa.fa-trash
                                    else
                                        td #{annotation.value.toString()} &nbsp;
                                            a(href = '/search/<' + encodeURIComponent(annotation.nameDef) + '>=' + encodeURIComponent('\''+annotation.value.replace('\'','\\\'')+'\'') + '&', title = 'Find all records with this annotation')
                                                span.fa.fa-search

                            block topLevelPropertyTable
            .col-md-6
                block topLevelRightOfPropertyTable


        div.row
            div.col-md-8

                block topLevelBelowTitle

                block topLevelBelowPropertyTable

            div.col-md-4.entry-actions
                block topLevelButtons
                if meta.triplestore != 'public'
                    li.btn.btn-success
                            a(onclick="popup()",title='Share',style="color:white")
                                span.fa.fa-share
                if meta.triplestore != 'public' && locals.user && locals.user.isCurator
                    li.btn.btn-success
                            a(href=meta.url + '/makePublic',title='Make Public',style="color:white")
                                span.fa.fa-unlock
                if canEdit && meta.triplestore != 'public'
                    if rdfType.name == 'Collection'
                        li.btn.btn-success
                                a(href=meta.url + '/removeCollection',title='Remove Collection',style="color:white")
                                    span.fa.fa-remove
                    else
                        li.btn.btn-success
                                a(href=meta.url + '/remove',title='Remove',style="color:white")
                                    span.fa.fa-remove
                if canEdit
                    li.btn.btn-info
                            a(href=meta.url + "/addOwner",title='Add Owner',style="color:white")
                                span.fa.fa-id-card
            br
            br

        +mutable-notes(meta.mutableNotesSource, meta.mutableNotes, canEdit)
        +citations(citationsSource, submissionCitations, canEdit)

        if collections.length > 0
            div.row.entry-heading
                div.col-sm-5.entry-title
                    | <h3>Member of Libraries</h3>

            div.row
                div.col-md-8
                    table.table.table-striped.entry-detail-table
                        tr
                            td
                                for collection in collections
                                    a(href=collection.url,title=collection.name) #{collection.name} &nbsp;
                                        a(href='/search/collection=<'+encodeURIComponent(collection.uri)+'>&',title='Find all records in this collection')
                                            span.fa.fa-search
                                    br

                .panel.panel-default
                    .panel-heading
                        h4.panel-title
                            a.accordion-toggle(data-toggle='collapse', href='#collapseThree')
                                | <b>Attachments</b>
                    #collapseThree.panel-collapse.collapse
                        .panel-body
                            div.row
                                div.col-md-12
                                    +attachments(meta.url, meta.attachments, canEdit)
